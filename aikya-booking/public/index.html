<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Aikya Booking - Property Reservation</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #8C1007;
      --primary-dark: #660B05;
      --primary-light: rgba(140, 16, 7, 0.08);
      --accent: #FFB22C;
      --accent-light: rgba(255, 178, 44, 0.1);
      --background: #0A0A0A;
      --surface: #1A1A1A;
      --card-bg: rgba(255, 255, 255, 0.05);
      --text: #FFFFFF;
      --text-secondary: #A0A0A0;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #0A0A0A 0%, #1A1A1A 50%, #2A1E1C 100%);
      color: var(--text);
      min-height: 100vh;
    }
    
    .glass-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
    }
    
    .mode-toggle {
      display: inline-flex;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 6px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .mode-toggle button {
      padding: 14px 28px;
      border-radius: 12px;
      font-weight: 600;
      color: var(--text-secondary);
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      position: relative;
      overflow: hidden;
    }
    
    .mode-toggle button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: left 0.6s;
    }
    
    .mode-toggle button:hover::before {
      left: 100%;
    }
    
    .mode-toggle .active {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      box-shadow: 0 8px 25px rgba(140, 16, 7, 0.4);
    }
    
    .mode-toggle button:hover:not(.active) {
      background: var(--accent-light);
      color: var(--accent);
      transform: translateY(-2px);
    }
    
    .property-card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
      border-radius: 20px;
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      cursor: pointer;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    }
    
    .property-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      transform: scaleX(0);
      transition: transform 0.4s ease;
    }
    
    .property-card:hover:not(.disabled) {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 20px 40px rgba(140, 16, 7, 0.3);
      border-color: rgba(255, 178, 44, 0.3);
    }
    
    .property-card:hover:not(.disabled)::before {
      transform: scaleX(1);
    }
    
    .property-card.selected {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 20px 40px rgba(140, 16, 7, 0.5);
      border-color: var(--accent);
    }
    
    .property-card.selected::before {
      transform: scaleX(1);
      background: var(--accent);
    }
    
    .property-card.disabled {
      background: rgba(255, 255, 255, 0.02);
      color: var(--text-secondary);
      cursor: not-allowed;
      opacity: 0.5;
    }
    
    .property-card.disabled::after {
      content: "Not Available";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(140, 16, 7, 0.9);
      color: white;
      padding: 8px 16px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      backdrop-filter: blur(10px);
    }
    
    .form-input {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: var(--text);
      border-radius: 16px;
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      backdrop-filter: blur(10px);
    }
    
    .form-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 4px rgba(255, 178, 44, 0.15);
      background: rgba(255, 255, 255, 0.08);
      transform: translateY(-2px);
    }
    
    .form-input::placeholder {
      color: var(--text-secondary);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      border-radius: 16px;
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      box-shadow: 0 8px 25px rgba(140, 16, 7, 0.4);
      position: relative;
      overflow: hidden;
    }
    
    .btn-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.6s;
    }
    
    .btn-primary:hover::before {
      left: 100%;
    }
    
    .btn-primary:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 30px rgba(140, 16, 7, 0.6);
    }
    
    .btn-secondary {
      background: linear-gradient(135deg, #2A2A2A 0%, #1A1A1A 100%);
      color: white;
      border-radius: 16px;
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
    }
    
    .btn-secondary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: left 0.6s;
    }
    
    .btn-secondary:hover::before {
      left: 100%;
    }
    
    .btn-secondary:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.5);
    }
    
    .loading-spinner { 
      animation: spin 1s linear infinite; 
    }
    
    @keyframes spin { 
      from { transform: rotate(0deg); } 
      to { transform: rotate(360deg); } 
    }
    
    .fade-in { 
      animation: fadeIn 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; 
    }
    
    @keyframes fadeIn { 
      from { opacity:0; transform:translateY(30px); } 
      to { opacity:1; transform:translateY(0); } 
    }
    
    .brand-gradient {
      background: linear-gradient(135deg, var(--accent) 0%, var(--primary) 50%, #FFFFFF 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      background-size: 200% 200%;
      animation: gradientShift 3s ease infinite;
    }
    
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    .status-indicator {
      display: inline-flex;
      align-items: center;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      backdrop-filter: blur(10px);
    }
    
    .status-available {
      background: rgba(34, 197, 94, 0.15);
      color: #22C55E;
      border: 1px solid rgba(34, 197, 94, 0.3);
    }
    
    .status-booked {
      background: rgba(239, 68, 68, 0.15);
      color: #EF4444;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }
    
    .floating-element {
      animation: float 6s ease-in-out infinite;
    }
    
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }
    
    .pulse-glow {
      animation: pulseGlow 2s ease-in-out infinite alternate;
    }
    
    @keyframes pulseGlow {
      from { box-shadow: 0 0 20px rgba(140, 16, 7, 0.3); }
      to { box-shadow: 0 0 30px rgba(255, 178, 44, 0.4); }
    }

    .property-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 20px;
      margin-top: 32px;
    }

    .property-icon {
      width: 60px;
      height: 60px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px auto;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      font-size: 20px;
    }
  </style>
</head>
<body class="min-h-screen py-8 px-4">

  <!-- Background Elements -->
  <div class="fixed inset-0 overflow-hidden pointer-events-none">
    <div class="absolute top-1/4 left-1/4 w-64 h-64 bg-[#8C1007] rounded-full filter blur-3xl opacity-10 floating-element"></div>
    <div class="absolute bottom-1/3 right-1/4 w-96 h-96 bg-[#FFB22C] rounded-full filter blur-3xl opacity-5 floating-element" style="animation-delay: -2s;"></div>
    <div class="absolute top-1/2 left-1/2 w-80 h-80 bg-[#660B05] rounded-full filter blur-3xl opacity-10 floating-element" style="animation-delay: -4s;"></div>
  </div>

  <div class="max-w-6xl mx-auto relative z-10">
    <!-- Header -->
    <div class="text-center mb-16 fade-in">
      <div class="flex justify-center items-center mb-6">
        <div class="w-20 h-20 rounded-2xl glass-card flex items-center justify-center text-white text-3xl font-bold mr-6 pulse-glow">
          <i class="fas fa-home text-[#FFB22C]"></i>
        </div>
        <div class="text-left">
          <h1 class="text-6xl font-black brand-gradient mb-2">Aikya</h1>
          <p class="text-xl text-[#A0A0A0]">Property Reservation System</p>
        </div>
      </div>
    </div>

    <!-- Main Card -->
    <div class="glass-card rounded-3xl overflow-hidden fade-in">
      
      <!-- Mode Toggle -->
      <div class="flex justify-center py-10" style="background: linear-gradient(90deg, transparent, rgba(255,178,44,0.05), transparent);">
        <div class="mode-toggle" role="tablist" aria-label="Mode toggle">
          <button id="modeBook" class="active" type="button" role="tab" aria-selected="true">
            <i class="fas fa-plus-circle mr-3"></i> Book Reservation
          </button>
          <button id="modeCancel" type="button" role="tab" aria-selected="false">
            <i class="fas fa-times-circle mr-3"></i> Cancel Reservation
          </button>
        </div>
      </div>

      <!-- Form Content -->
      <div class="px-10 pb-10">
        <form id="reservationForm" class="space-y-10">
          <!-- Date Selection -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="space-y-4">
              <label for="checkInDate" class="block text-lg font-semibold text-white">
                <i class="fas fa-calendar-day mr-3 text-[#FFB22C]"></i> Check-in Date
              </label>
              <input type="date" id="checkInDate" name="checkInDate" required class="form-input w-full p-5 focus:outline-none transition duration-300 text-lg">
            </div>
            <div class="space-y-4">
              <label for="checkOutDate" class="block text-lg font-semibold text-white">
                <i class="fas fa-calendar-day mr-3 text-[#FFB22C]"></i> Check-out Date
              </label>
              <input type="date" id="checkOutDate" name="checkOutDate" required class="form-input w-full p-5 focus:outline-none transition duration-300 text-lg">
            </div>
          </div>

          <!-- Property Selection -->
          <div class="space-y-6">
            <div class="flex items-center justify-between">
              <h3 class="text-2xl font-bold text-white">
                <i class="fas fa-building mr-3 text-[#FFB22C]"></i> Select Property
              </h3>
              <div id="availabilityStatus" class="text-md font-medium text-[#FFB22C]">
                <i class="fas fa-info-circle mr-2"></i> Select dates to check availability
              </div>
            </div>
            
            <!-- Clean Property Grid -->
            <div id="propertyGrid" class="property-grid"></div>
            <input type="hidden" id="selectedProperty" name="property" required>
          </div>

          <!-- Guest Information -->
          <div id="guestInfoSection" class="space-y-8">
            <h3 class="text-2xl font-bold text-white">
              <i class="fas fa-user-friends mr-3 text-[#FFB22C]"></i> Guest Information
            </h3>
            <div class="space-y-4">
              <label for="guestName" class="block text-lg font-semibold text-white">Guest Name</label>
              <input type="text" id="guestName" name="guestName" required class="form-input w-full p-5 focus:outline-none transition duration-300 text-lg" placeholder="Enter guest name">
            </div>
            <div id="bookingOnlyFields" class="grid grid-cols-1 md:grid-cols-2 gap-8">
              <div class="space-y-4">
                <label for="numberOfGuests" class="block text-lg font-semibold text-white">Number of Guests</label>
                <input type="number" id="numberOfGuests" name="numberOfGuests" required min="1" max="20" class="form-input w-full p-5 focus:outline-none transition duration-300 text-lg" placeholder="e.g., 2">
              </div>
              <div class="space-y-4">
                <label for="amountPaid" class="block text-lg font-semibold text-white">Amount Paid</label>
                <div class="relative">
                  <span class="absolute left-5 top-1/2 transform -translate-y-1/2 text-[#FFB22C] text-lg">â‚¹</span>
                  <input type="number" id="amountPaid" name="amountPaid" required min="0" step="0.01" class="form-input w-full p-5 pl-12 focus:outline-none transition duration-300 text-lg" placeholder="e.g., 2000">
                </div>
              </div>
            </div>
          </div>

          <!-- Submit Button -->
          <div class="pt-8">
            <button id="submitBtn" type="submit" class="btn-primary w-full py-5 px-6 text-xl font-bold focus:outline-none focus:ring-4 focus:ring-opacity-50 transition duration-300">
              <span id="submitText">Book Reservation</span>
              <div id="loadingSpinner" class="hidden inline-block w-6 h-6 border-2 border-white border-t-transparent rounded-full loading-spinner ml-3"></div>
            </button>
          </div>
        </form>
        
        <!-- Message Box -->
        <div id="messageBox" class="mt-8 text-center font-medium p-5 rounded-2xl hidden transition-all duration-300 backdrop-filter blur-md"></div>
      </div>
    </div>
    
    <!-- Footer -->
    <div class="text-center mt-12 text-[#A0A0A0] text-sm">
      <p>Â© 2023 Aikya Properties</p>
    </div>
  </div>

  <script>
    const ENDPOINT = '/api'; // ðŸ‘ˆ replace with Apps Script URL

    const PROPERTIES = ['101','102','201','202','302','Kadri 2BHK','Kadri 3BHK',
      'Villa 2BHK','Villa 1BHK','Falnir 2BHK','R401','R402','Palace'];

    let mode = 'book';
    let selectedProperty = null;
    const modeBookBtn = document.getElementById('modeBook');
    const modeCancelBtn = document.getElementById('modeCancel');
    const submitBtn = document.getElementById('submitBtn');
    const submitText = document.getElementById('submitText');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const messageBox = document.getElementById('messageBox');
    const reservationForm = document.getElementById('reservationForm');
    const propertyGrid = document.getElementById('propertyGrid');
    const selectedPropertyInput = document.getElementById('selectedProperty');
    const availabilityStatus = document.getElementById('availabilityStatus');
    const guestNameInput = document.getElementById('guestName');
    const numGuestsInput = document.getElementById('numberOfGuests');
    const amountPaidInput = document.getElementById('amountPaid');
    const checkInInput = document.getElementById('checkInDate');
    const checkOutInput = document.getElementById('checkOutDate');

    // Initialize the UI
    generatePropertyGrid();
    setMinimumDates();
    setActiveMode('book');

    // Generate clean property grid
    function generatePropertyGrid() {
      propertyGrid.innerHTML = '';
      PROPERTIES.forEach(property => {
        const card = document.createElement('div');
        card.className = 'property-card p-6 text-center';
        card.dataset.property = property;
        card.innerHTML = `
          <div class="property-icon">
            <i class="fas fa-home"></i>
          </div>
          <div class="font-bold text-xl mb-2">${property}</div>
          <div class="status-indicator status-available">
            <i class="fas fa-check-circle mr-1"></i> Available
          </div>
        `;
        card.addEventListener('click', () => selectProperty(property, card));
        propertyGrid.appendChild(card);
      });
    }

    // Select a property
    function selectProperty(propertyId, cardElement) {
      if (cardElement.classList.contains('disabled')) return;
      document.querySelectorAll('.property-card').forEach(c => c.classList.remove('selected'));
      cardElement.classList.add('selected');
      selectedProperty = propertyId;
      selectedPropertyInput.value = propertyId;
    }

    // Set minimum dates to today
    function setMinimumDates() {
      const today = new Date().toISOString().split('T')[0];
      checkInInput.min = today;
      checkOutInput.min = today;
    }

    // Check property availability
    async function checkAvailability() {
      const checkIn = checkInInput.value;
      const checkOut = checkOutInput.value;
      
      if (!checkIn || !checkOut) { 
        availabilityStatus.innerHTML = '<i class="fas fa-info-circle mr-2"></i> Select dates to check availability'; 
        resetPropertyAvailability(); 
        return; 
      }
      
      if (new Date(checkOut) < new Date(checkIn)) { 
        availabilityStatus.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i> Check-out must be after check-in'; 
        resetPropertyAvailability(); 
        return; 
      }
      
      availabilityStatus.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Checking availability...';
      
      try {
        const res = await fetch(`${ENDPOINT}?action=availabilityRange&from=${checkIn}&to=${checkOut}`);
        const data = await res.json();
        if (data.error) throw new Error(data.error);

        let available = [], unavailable = [];
        if (mode === 'book') {
          available = data.available_rooms || [];
          unavailable = data.unavailable_rooms || [];
        } else { 
          // In cancel mode, invert logic: show only booked properties
          available = data.unavailable_rooms || [];
          unavailable = data.available_rooms || [];
        }

        document.querySelectorAll('.property-card').forEach(card => {
          const property = card.dataset.property;
          const statusEl = card.querySelector('.status-indicator');
          
          if (available.includes(property)) {
            card.classList.remove('disabled'); 
            statusEl.className = 'status-indicator status-available';
            statusEl.innerHTML = mode === 'book' 
              ? '<i class="fas fa-check-circle mr-1"></i> Available' 
              : '<i class="fas fa-key mr-1"></i> Booked';
          } else {
            card.classList.add('disabled'); 
            card.classList.remove('selected');
            statusEl.className = 'status-indicator status-booked';
            statusEl.innerHTML = mode === 'book' 
              ? '<i class="fas fa-times-circle mr-1"></i> Booked' 
              : '<i class="fas fa-check-circle mr-1"></i> Available';
            if (selectedProperty === property) { 
              selectedProperty = null; 
              selectedPropertyInput.value = ''; 
            }
          }
        });
        
        availabilityStatus.innerHTML = mode === 'book' 
          ? `<i class="fas fa-check-circle mr-2 text-[#22C55E]"></i> ${available.length} properties available` 
          : `<i class="fas fa-info-circle mr-2"></i> ${available.length} properties booked`;
          
      } catch(err) { 
        console.error(err); 
        availabilityStatus.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i> Error checking availability'; 
      }
    }

    // Reset property availability display
    function resetPropertyAvailability() {
      document.querySelectorAll('.property-card').forEach(card => {
        card.classList.remove('disabled', 'selected');
        const statusEl = card.querySelector('.status-indicator');
        statusEl.className = 'status-indicator status-available';
        statusEl.innerHTML = '<i class="fas fa-check-circle mr-1"></i> Available';
      });
      selectedProperty = null;
      selectedPropertyInput.value = '';
    }

    // Event listeners for date inputs
    checkInInput.addEventListener('change', function() {
      checkOutInput.min = this.value;
      if (checkOutInput.value && checkOutInput.value <= this.value) {
        const nextDay = new Date(this.value);
        nextDay.setDate(nextDay.getDate() + 1);
        checkOutInput.value = nextDay.toISOString().split('T')[0];
      }
      checkAvailability();
    });
    
    checkOutInput.addEventListener('change', checkAvailability);

    // Set active mode (book/cancel)
    function setActiveMode(newMode) {
      mode = newMode;
      const bookingOnlyFields = document.getElementById('bookingOnlyFields');
      
      if (mode === 'book') {
        modeBookBtn.classList.add('active');
        modeCancelBtn.classList.remove('active');
        submitText.textContent = 'Book Reservation';
        submitBtn.className = 'btn-primary w-full py-5 px-6 text-xl font-bold focus:outline-none focus:ring-4 focus:ring-opacity-50 transition duration-300';
        bookingOnlyFields.style.display = 'grid';
        guestNameInput.required = true;
        numGuestsInput.required = true;
        amountPaidInput.required = true;
      } else {
        modeBookBtn.classList.remove('active');
        modeCancelBtn.classList.add('active');
        submitText.textContent = 'Cancel Reservation';
        submitBtn.className = 'btn-secondary w-full py-5 px-6 text-xl font-bold focus:outline-none focus:ring-4 focus:ring-opacity-50 transition duration-300';
        bookingOnlyFields.style.display = 'none';
        guestNameInput.required = true;
        numGuestsInput.required = false;
        amountPaidInput.required = false;
        numGuestsInput.value = '';
        amountPaidInput.value = '';
      }
      
      hideMessage();
      checkAvailability();
    }

    // Mode toggle event listeners
    modeBookBtn.addEventListener('click', () => setActiveMode('book'));
    modeCancelBtn.addEventListener('click', () => setActiveMode('cancel'));

    // Form submission
    reservationForm.addEventListener('submit', async function(ev) {
      ev.preventDefault();
      
      if (!selectedProperty) {
        showMessage('Please select a property.', 'error');
        return;
      }
      
      const formData = new FormData(ev.target);
      const payload = {
        guestName: formData.get('guestName'),
        checkInDate: formData.get('checkInDate'),
        checkOutDate: formData.get('checkOutDate'),
        property: selectedProperty,
        noOfGuests: parseInt(formData.get('numberOfGuests')) || undefined,
        amountPaid: parseFloat(formData.get('amountPaid')) || undefined,
        action: mode
      };
      
      if (new Date(payload.checkOutDate) < new Date(payload.checkInDate)) {
        showMessage('Check-out must be after check-in', 'error');
        return;
      }
      
      // Show loading state
      submitBtn.disabled = true;
      submitText.textContent = mode === 'cancel' ? 'Processing cancellation...' : 'Processing booking...';
      loadingSpinner.classList.remove('hidden');
      
      try {
        const res = await fetch(ENDPOINT, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify(payload)
        });
        
        const result = await res.json();
        
        if (result.success) {
          showMessage(result.message, 'success');
          setTimeout(() => {
            reservationForm.reset();
            resetPropertyAvailability();
            setMinimumDates();
          }, 2000);
        } else {
          showMessage((mode === 'cancel' ? 'Cancellation' : 'Booking') + ' failed: ' + (result.error || result.message || 'Unknown error'), 'error');
        }
      } catch(err) {
        console.error(err);
        showMessage(`Connection error: ${err.message}`, 'error');
      } finally {
        // Reset button state
        submitBtn.disabled = false;
        submitText.textContent = mode === 'cancel' ? 'Cancel Reservation' : 'Book Reservation';
        loadingSpinner.classList.add('hidden');
      }
    });

    // Show message
    function showMessage(text, type) {
      messageBox.textContent = text;
      messageBox.classList.remove('hidden');
      
      if (type === 'success') {
        messageBox.style.background = 'linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(34, 197, 94, 0.1) 100%)';
        messageBox.style.color = '#22C55E';
        messageBox.style.border = '1px solid rgba(34, 197, 94, 0.3)';
      } else {
        messageBox.style.background = 'linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(239, 68, 68, 0.1) 100%)';
        messageBox.style.color = '#EF4444';
        messageBox.style.border = '1px solid rgba(239, 68, 68, 0.3)';
      }
    }

    // Hide message
    function hideMessage() {
      messageBox.classList.add('hidden');
    }
  </script>
</body>
</html>
